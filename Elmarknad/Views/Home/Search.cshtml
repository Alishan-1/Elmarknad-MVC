@model Elmarknad.Models.ViewModels.ListSearchResultViewModel

@{
    ViewBag.Title = "Lägsta priset i ditt område";
    int antalAvtal = Model.Clients.Count + Model.Scraped.Count;
}
<div class="col-xs-10 center-block" style="background-color: #f7f7f7 !important; margin-top: 1%; margin-bottom: 1%;">
    <h2 class="text-center" style="color: #1b5b82;">Visar alla elavtal med postnummer @Model.Postnummer</h2>
    <div class="col-lg-offset-2 col-md-10">
        <div class="col-md-4" style="margin: 2%;">
            <input type="text" id="search-comp"class="form-control" placeholder="Sök efter Elbolag...." />
        </div>
        <div class="col-md-4" style="margin: 2%;">
            @Html.DropDownListFor(m => m.Typ, Model.TypList, new { @class = "form-control" })
        </div>
        <div class="col-md-4" style="margin: 2%;">
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-secondary active" id="price">
                    <input type="radio" name="options" id="option1" autocomplete="off" checked> Pris
                </label>
                <label class="btn btn-secondary" id="rating">
                    <input type="radio" name="options" id="option2" autocomplete="off"> Betyg
                </label>
            </div>
        </div>
    </div>


</div>

<div class="col-xs-10">

    <table class="table table-striped search-table">
        <thead style="background-color: #1b5b82;">
            <tr>
                <th scope="col" style="color: #fff;">Elbolag</th>
                <th scope="col" style="color: #fff;">Vilkor</th>
                <th scope="col" style="color: #fff;">Om Avtalet</th>
                <th scope="col" style="color: #fff;">Pris</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Clients)
            {
                <tr class="to-hide-client">
                    <td>
                        <ul style="list-style: none">
                            <li><img src="../@item.Image" class="img-responsive" style="width: 15%;" /></li>
                            <li>@item.Company</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>Avtalstyp: @Model.Typ</li>
                            <li>Avtalstid: 12 månader</li>
                            <li>Uppsägningstid: @item.Uppsägningstid</li>
                            <li>Kundbetyg: @item.Rating</li>
                        </ul>
                    </td>
                    <td>
                        @item.Contract
                    </td>
                    <td>
                        @item.Price
                    </td>
                    <td>
                        @Html.ActionLink("Teckna avtal", "", "", new { @class = "btn btn-primary", @style = "background-color: #f07451 !important;" })
                    </td>
                </tr>
            }
            @foreach (var item in Model.Scraped)
            {
                <tr class="to-hide-scrape">
                    <td>
                        @item.Company
                    </td>
                    <td>
                        <ul>
                            <li>Avtalstyp: @Model.Typ</li>
                            <li>Avtalstid: 12 månader</li>
                            <li>Uppsägningstid: @item.Uppsägningstid</li>
                            <li>Kundbetyg: @item.Rating</li>
                        </ul>
                    </td>
                    <td>
                        @item.Contract
                    </td>
                    <td>
                        @item.Price
                    </td>
                    <td>
                        @Html.ActionLink("Teckna avtal", "some", new { id = item.SearchId }, new { @class = "btn btn-primary", @style = "background-color: #f07451 !important;" })
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<div class="col-xs-10">
    <div class="center-block"><button class="btn btn-success center-block" id="show-all" style="margin-bottom: 10%;">Visa Mer <br /> @antalAvtal Avtal </button></div>
</div>
@section Scripts {
<script>
        $(document).ready(function () {
            $(".to-hide-client:gt(2)").css("display", "none");
            $(".to-hide-scrape:gt(2)").css("display", "none");
        });

        $("#search-comp").on("keyup", function () {
        var value = $("#search-comp").val();
        alert(value);
        });

        $("#show-all").on("click", function () {
            $(".to-hide-client:gt(2)").fadeToggle(500);
            $(".to-hide-scrape:gt(2)").fadeToggle(500);;
            $("#show-all").hide();
        });

        $("#price").on("click", function () {
             var typ = "@Html.Raw(@Model.Typ)";
            $.ajax({
                url: "/api/search/price",
                type: "Post",
                data: JSON.stringify([@Model.Förbrukning, typ, @Model.ElId]),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $("#show-all").hide();
                    $(".to-hide-client").remove();
                    $(".to-hide-scrape").remove();
                    for (var i = 0; i < data.Clients.length; i++) {
                        $(".search-table").append("<tr class='to-hide-client'><td><ul style='list-style: none'>" +
                            "<li><img src=" + "'../" + data.Clients[i].Image + "'" + "class='img-responsive' style='width: 15%;' /></li>" +
                            "<li>" + data.Clients[i].Company + "</li > </ul></td >" +
                            "<td><ul><li>Avtalstyp: " + data.Typ + "</li >" +
                            "<li>Avtalstid: 12 månader</li>" +
                            "<li>Uppsägningstid: " + data.Clients[i].Uppsägningstid + "</li>" +
                            "<li>Kundbetyg: " + data.Clients[i].Rating + "</li >" +
                            "</ul></td><td>" + data.Clients[i].Contract + "</td >" +
                            "<td>" + data.Clients[i].Price + "</td ><td>" +
                            "<a class='btn btn-primary' href='/Home/some/112' style='background-color: #f07451 !important;'>Teckna avtal</a></td></tr>");
                    }

                    for (var i = 0; i < data.Scraped.length; i++) {
                        $(".search-table").append("<tr class='to-hide-client'><td>" + data.Scraped[i].Company + "</td >" +
                            "<td><ul><li>Avtalstyp: " + data.Typ + "</li >" +
                            "<li>Avtalstid: 12 månader</li>" +
                            "<li>Uppsägningstid: " + data.Scraped[i].Uppsägningstid + "</li>" +
                            "<li>Kundbetyg: " + data.Scraped[i].Rating + "</li >" +
                            "</ul></td><td>" + data.Scraped[i].Contract + "</td >" +
                            "<td>" + data.Scraped[i].Price + "</td ><td>" +
                            "<a class='btn btn-primary' href='/Home/some/112' style='background-color: #f07451 !important;'>Teckna avtal</a></td></tr>");
                    }

                },
                error: function () {

                }
            })
        });

        $("#rating").on("click", function () {
            var typ = "@Html.Raw(@Model.Typ)";
            $.ajax({
                url: "/api/search/rating",
                type: "Post",
                data: JSON.stringify([@Model.Förbrukning, typ, @Model.ElId]),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $("#show-all").hide();
                    $(".to-hide-client").remove();
                    $(".to-hide-scrape").remove();
                    for (var i = 0; i < data.Clients.length; i++) {
                        $(".search-table").append("<tr class='to-hide-client'><td><ul style='list-style: none'>" +
                            "<li><img src=" + "'../" + data.Clients[i].Image + "'" + "class='img-responsive' style='width: 15%;' /></li>" +
                            "<li>" + data.Clients[i].Company + "</li > </ul></td >" +
                            "<td><ul><li>Avtalstyp: " + data.Typ + "</li >" +
                            "<li>Avtalstid: 12 månader</li>" +
                            "<li>Uppsägningstid: " + data.Clients[i].Uppsägningstid + "</li>" +
                            "<li>Kundbetyg: " + data.Clients[i].Rating + "</li >" +
                            "</ul></td><td>" + data.Clients[i].Contract + "</td >" +
                            "<td>" + data.Clients[i].Price + "</td ><td>" +
                            "<a class='btn btn-primary' href='/Home/some/112' style='background-color: #f07451 !important;'>Teckna avtal</a></td></tr>");
                    }

                    for (var i = 0; i < data.Scraped.length; i++) {
                        $(".search-table").append("<tr class='to-hide-client'><td>" + data.Scraped[i].Company + "</td >" +
                            "<td><ul><li>Avtalstyp: " + data.Typ + "</li >" +
                            "<li>Avtalstid: 12 månader</li>" +
                            "<li>Uppsägningstid: " + data.Scraped[i].Uppsägningstid + "</li>" +
                            "<li>Kundbetyg: " + data.Scraped[i].Rating + "</li >" +
                            "</ul></td><td>" + data.Scraped[i].Contract + "</td >" +
                            "<td>" + data.Scraped[i].Price + "</td ><td>" +
                            "<a class='btn btn-primary' href='/Home/some/112' style='background-color: #f07451 !important;'>Teckna avtal</a></td></tr>");
                    }
                 
                },
                error: function () {

                }
            })
        });
</script>
}
